---
// src/pages/background/[slug].astro
import Base from "../../layouts/Base.astro";
import Nav from "../../components/Nav.tsx";
import Footer from "../../components/Footer.tsx";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("backgrounds");
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { title, image, summary } = entry.data;
const { Content } = await entry.render();

const joinBase = (path: string) => {
  const base = (import.meta.env.BASE_URL ?? "/") as string;
  const b = base.endsWith("/") ? base.slice(0, -1) : base;
  const p = path.startsWith("/") ? path.slice(1) : path;
  return `${b}/${p}`;
};
---

<Base title={`${title} â€“ Bakgrund`}>
  <Fragment slot="header"><Nav client:load /></Fragment>

  <article class="prose prose-slate dark:prose-invert max-w-none">
    <h1>{title}</h1>
    {summary && <p class="opacity-80">{summary}</p>}
    {image && <img src={joinBase(image)} alt="" class="rounded-xl my-4" />}
    <Content />
  </article>

  <Fragment slot="footer"><Footer /></Fragment>
</Base>

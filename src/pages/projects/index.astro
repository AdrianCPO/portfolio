---
// src/pages/projects/index.astro
import Base from "../../layouts/Base.astro";
import Nav from "../../components/Nav.tsx";
import Footer from "../../components/Footer.tsx";
import ProjectsGrid, { type Project } from "../../components/ProjectsGrid.tsx";
import { getCollection, type CollectionEntry } from "astro:content";

// Samma helper som i din övriga kod (om du vill använda bilder med BASE_URL)
const withBase = (p?: string) => {
  if (!p) return undefined;
  const base = import.meta.env.BASE_URL || "/";
  const b = base.endsWith("/") ? base.slice(0, -1) : base;
  const pp = p.startsWith("/") ? p.slice(1) : p;
  return `${b}/${pp}`;
};

const raw = await getCollection("projects");
const projects: Project[] = raw
  .map((p: CollectionEntry<"projects">) => ({
    slug: p.id.split("/").pop()?.replace(/\.(md|mdx)$/, "") ?? p.id,
    title: p.data.title,
    summary: p.data.summary,
    tags: p.data.tags,
    image: withBase(p.data.image),
    repo: p.data.repo,
    demo: p.data.demo,
    date: p.data.date ?? null,
  }))
  .sort((a, b) => (b.date ?? "").localeCompare(a.date ?? ""));
---

<Base title="Projekt – Adrian">
  <Fragment slot="header"><Nav client:load /></Fragment>
  <h1 class="text-2xl font-bold mb-4">Projekt</h1>
  <ProjectsGrid items={projects} />
  <Fragment slot="footer"><Footer /></Fragment>
</Base>
